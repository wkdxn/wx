<link rel="preconnect" href="https://github.githubassets.com">
<link rel="dns-prefetch" href="https://github.githubassets.com">
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>微信好友添加引导</title>
    <style>
        /* ===== 全局样式重置 ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #f0f2f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: -apple-system, system-ui, sans-serif;
            padding: 20px;
        }

        /* ===== 加载过渡动画 ===== */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ===== 主容器 ===== */
        .container {
            max-width: 600px;
            width: 100%;
            text-align: center;
            animation: fade-in 0.5s ease;
        }

        /* ===== 二维码区域 ===== */
        .qr-card {
            background: #fff;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0,0,0,0.08);
            margin: 20px auto;
        }

        .qr-image {
            width: 100%;
            max-width: 300px;
            height: auto;
            margin: 1.5rem 0;
            border-radius: 12px;
            -webkit-touch-callout: none;
        }

        /* ===== 操作指引 ===== */
        .guide-text {
            color: #666;
            font-size: 0.95rem;
            margin: 1.5rem 0;
            line-height: 1.6;
        }

        .action-button {
            background: #07c160;
            color: white;
            border: none;
            padding: 12px 36px;
            border-radius: 28px;
            font-size: 1rem;
            cursor: pointer;
            transition: filter 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .action-button:hover {
            filter: brightness(0.95);
        }

        /* ===== 设备适配 ===== */
        @media (max-width: 480px) {
            .qr-card {
                padding: 1.5rem;
                border-radius: 16px;
            }
            
            .qr-image {
                max-width: 280px;
            }
            
            .action-button {
                width: 100%;
                justify-content: center;
            }
        }

        /* ===== 微信浏览器特殊样式 ===== */
        .wechat-only {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="qr-card">
            <h1>添加微信好友</h1>
            
            <!-- 二维码图片 -->
            <img src="./images/wxtp.jpg" 
                 class="qr-image"
                 alt="微信二维码"
                 loading="eager"
                 oncontextmenu="return false"
                 onerror="handleImageError(this)">

            <!-- 微信环境提示 -->
            <div class="wechat-only" id="wechat-tip">
                <p style="color:#e55039;">检测到微信浏览器，请保存二维码后使用扫一扫功能</p>
            </div>

            <!-- 操作指引 -->
            <div class="guide-text">
                <p>请选择以下任一方式添加：</p>
            </div>

            <!-- 双操作按钮 -->
            <div style="display: grid; gap: 1rem; margin-top: 2rem;">
                <button class="action-button" onclick="openWechat()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm3 11h-2v2c0 .55-.45 1-1 1s-1-.45-1-1v-2H9c-.55 0-1-.45-1-1s.45-1 1-1h2V9c0-.55.45-1 1-1s1 .45 1 1v2h2c.55 0 1 .45 1 1s-.45 1-1 1z"/>
                    </svg>
                    立即跳转微信
                </button>
                
                <button class="action-button" onclick="showSaveGuide()" 
                        style="background: #2d3436;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M19 21H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v14c0 1.1-.9 2-2 2zM12 7v6M9 10h6"/>
                    </svg>
                    保存二维码
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== 配置参数 =====
        const CONFIG = {
            wechatId: "你的微信号",  // 替换为真实微信号
            qrImage: "./images/wechat-qr.png",
            maxRetry: 2,          // 最大重试次数
            jumpTimeout: 1500     // 跳转等待时间(ms)
        };

        // ===== 环境检测 =====
        const isWechat = /MicroMessenger/i.test(navigator.userAgent);
        const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
        let retryCount = 0;

        // ===== 核心跳转函数 =====
        function openWechat() {
            if (retryCount >= CONFIG.maxRetry) {
                alert("跳转失败，请手动保存二维码");
                return;
            }

            try {
                retryCount++;
                window.location.href = `weixin://dl/add?username=${CONFIG.wechatId}`;
                
                // 跳转失败处理
                setTimeout(() => {
                    if (!document.hidden) {
                        showSaveGuide();
                    }
                }, CONFIG.jumpTimeout);

            } catch(e) {
                console.error("跳转异常:", e);
                showSaveGuide();
            }
        }

        // ===== 图片加载处理 =====
        function handleImageError(img) {
            console.error("二维码加载失败:", img.src);
            img.style.display = 'none';
            document.getElementById('wechat-tip').style.display = 'block';
        }

        // ===== 保存引导提示 =====
        function showSaveGuide() {
            const guide = confirm("跳转失败，是否查看保存指引？");
            if (guide) {
                window.open('https://example.com/save-guide', '_blank');
            }
        }

        // ===== 环境初始化 =====
        function init() {
            // 微信环境特殊处理
            if (isWechat) {
                document.getElementById('wechat-tip').style.display = 'block';
                document.querySelectorAll('.action-button')[0].style.display = 'none';
            }
            
            // iOS自动跳转限制
            if (isIOS && !isWechat) {
                openWechat(); // iOS需要用户交互才能触发跳转
            } else if (!isWechat) {
                setTimeout(openWechat, 500); // 其他环境自动触发
            }
        }

        // ===== 启动初始化 =====
        document.addEventListener('DOMContentLoaded', init);

        // ===== 防止iOS长按菜单 =====
        document.addEventListener('touchstart', (e) => {
            if (e.target.classList.contains('qr-image')) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>
